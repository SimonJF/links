open MvuEvents;

# Type definitions
## Attributes
typename AttrKey = String;
typename AttrValue = String;

# Monoidal attributes (including event handlers)
typename Attr(a :: Type(Any, Any)) =
  [| AttrEmpty
   | AttrAppend: (Attr(a), Attr(a))
   | AttrAttribute: (AttrKey, AttrValue)
   | AttrEventHandler: EventHandler(a) |];

fun attr(k, v) {
  AttrAttribute(k, v)
}

var empty = AttrEmpty;

fun eventHandler(hndlr) {
  AttrEventHandler(hndlr)
}

fun append(a1, a2) {
  switch ((a1, a2)) {
    case (AttrEmpty, a2) -> a2
    case (a1, AttrEmpty) -> a1
    case (a1, a2) -> AttrAppend(a1, a2)
  }
}

fun concat(attrs) {
  fold_right(fun(x, acc) { append(x, acc) }, AttrEmpty, attrs)
}

fun placeholder(val) {
    attr ("placeholder", val)
}

fun id(val) {
    attr ("id", val)
}

fun type(val) {
    attr ("type", val)
}

fun width(val) {
    attr ("width", val)
}

fun height(val) {
    attr ("height", val)
}

fun style(val) {
    attr ("style", val)
}

fun class (val) {
	attr ("className", val)
}

fun color(val) {
    attr ("color", val)
}

fun title(val) {
	attr ("title", val)
}

fun href(val) {
	attr ("href", val)
}

fun dir(val) {
	attr ("dir", val)
}

fun lang(val) {
	attr ("lang", val)
}

fun face(val) {
	attr ("face", val)
}

fun name(val) {
    attr ("name", val)
}

fun value(val) {
    attr ("value", val)
}

fun for_(val) {
    attr ("for", val)
}

fun text(val) {
    attr ("text", val)
}

fun href(val) {
    attr ("href", val)
}

fun autofocus(val) {
  if (val) {
    attr ("autofocus", "true")
  } else {
    AttrEmpty
  }
}

sig checked : (Bool) -> Attr(a)
fun checked(val) {
    if (val) {
      attr ("checked", "true")
    } else {
      AttrEmpty
    }
}

sig hidden : (Bool) -> Attr(a)
fun hidden(val) {
    if (val == true) {
      attr("hidden", "true")
    } else {
      AttrEmpty
    }
}

fun classList(classes) {
    switch (classes) {
        case ((val,b)::xs) ->
            if (b == true) {
                val ^^ " " ^^ classList(xs)
            } else {
                classList(xs)
            }
        case [] -> ""
    }
}


#### Event handlers which can be added as attributes.

### MOUSE HELPERS ###

fun onClick(f) {
  eventHandler(UnitHandler("onclick", f))
}

fun onClick(f) {
  eventHandler(UnitHandler("onchange", f))
}

fun onMouseMove(f) {
  eventHandler(UnitHandler("onmousemove", f))
}
fun onMouseDown(f) {
  eventHandler(UnitHandler("onmousedown", f))
}
fun onMouseUp(f) {
  eventHandler(UnitHandler("onmouseup", f))
}
fun onMouseEnter(f) {
  eventHandler(UnitHandler("onmouseenter", f))
}
fun onMouseLeave(f) {
  eventHandler(UnitHandler("onmouseleave", f))
}
fun onClick(f) {
  eventHandler(UnitHandler("onclick", f))
}
fun onDoubleClick(f) {
  eventHandler(UnitHandler("ondblclick", f))
}
fun onMouseOver(f) {
  eventHandler(UnitHandler("onmouseover", f))
}
fun onMouseOut(f) {
  eventHandler(UnitHandler("onmouseout", f))
}

### FOCUS HELPERS ###

fun onFocus(f) {
  eventHandler(UnitHandler("onfocus", f))
}

fun onBlur(f) {
  eventHandler(UnitHandler("onblur", f))
}

### KEYBOARD HELPERS ###

fun onKeyUp(f) {
  eventHandler(PropertyHandler("onkeyup", "value", fun(val) { Just(f(val)) } ))
}
fun onKeyDown(f) {
  eventHandler(PropertyHandler("onkeydown", "value", fun(val) { Just(f(val)) }))
}
fun onKeyPress(f) {
  eventHandler(PropertyHandler("onkeypress", "value", fun(val) { Just(f(val)) }))
}
fun onInput(f) {
  eventHandler(PropertyHandler("oninput", "value", fun(val) { Just(f(val)) }))
}

fun getKeycode(event, f) {
  eventHandler(EventDataHandler(event, "keyCode", fun(val) { Just(f(val)) } ))
}

fun onKeycode(event, keycode, f) {
  eventHandler(
    EventDataHandler(event, "keyCode",
      fun(kc) {
        if(keycode == stringToInt(kc)) {
          Just(f())
        } else {
          Nothing
        }
      }
    )
  )
}

fun onEnter(f) { onKeycode("onkeydown", 13, f) }


